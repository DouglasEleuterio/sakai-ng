<p-toast key="tst"></p-toast>

<div class="card">
    <p-divider align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-user mr-2"></i>
            <b>Número e Data</b>
        </div>
    </p-divider>
    <div class="flex-auto">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-6">
                <label for="ctr-numero">Número da CTR</label>
                <p-inputNumber id="ctr-numero" [(ngModel)]="ctr.numero" mode="decimal" inputId="withoutgrouping"
                               [useGrouping]="false"></p-inputNumber>
            </div>
            <div class="field col-6">
                <label for="data">Data Descarte</label>
                <p-calendar id="data" [(ngModel)]="ctr.geracao" [showSeconds]="true" [showTime]="true" dateFormat="dd/mm/yy" [maxDate]="ctr.geracao"
                            [showIcon]="true" inputId="icon">
                </p-calendar>
            </div>
        </div>
    </div>
    <p-divider align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-user mr-2"></i>
            <b>Transportadora</b>
        </div>
    </p-divider>
    <div class="flex-auto">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-6">
                <label for="transportadora">Transportadora</label>
                <app-auto-complete
                    id="transportadora"
                    [service]="transportadoraService"
                    (dataSelected)="onTransportadorSelecionado($event)">
                </app-auto-complete>
            </div>
            <div class="field col-6">
                <label for="veiculo">Veiculo</label>
                <app-auto-complete
                    id="veiculo"
                    [service]="veiculoService"
                    (dataSelected)="onVeiculoSelecionado($event)">
                </app-auto-complete>
            </div>
            <div class="field col-6">
                <label for="motorista">Motorista</label>
                <app-auto-complete
                    id="motorista"
                    [service]="motoristaService"
                    (dataSelected)="onMotoristaSelecionado($event)">
                </app-auto-complete>
            </div>
        </div>
    </div>
    <p-divider *ngIf="false" align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-user mr-2"></i>
            <b>Gerador</b>
        </div>
    </p-divider>
    <p-divider *ngIf="false" align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-user mr-2"></i>
            <b>Destinatario</b>
        </div>
    </p-divider>
    <p-divider align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-user mr-2"></i>
            <b>Descarte</b>
        </div>
    </p-divider>
    <div class="flex-auto">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-6">
                <label for="tipo-descarte">Tipo de Descarte</label>
                <app-auto-complete
                    id="tipo-descarte"
                    [service]="tipoDescarteService"
                    (dataSelected)="onTipoDescarteSelecionado($event)">
                </app-auto-complete>
            </div>
            <div class="field col-6">
                <label for="tipo-descarte">Quantidade</label>
                <p-inputNumber id="quantidade" mode="decimal"
                               [(ngModel)]="quantidadeDescarte">
                </p-inputNumber>
            </div>
            <div class="col-9">
            </div>
            <div class="col-3">
                <button pButton pRipple type="button"  id="adicionar" icon="pi pi-car" label="Adicionar Descarte"
                          [disabled]="tipoDescarteSelecionado.id === '' || quantidadeDescarte <= 0 "
                        class="p-button-raised p-button-help" (click)="adicionarDescarte()"></button>
            </div>
            <div class="field col-12">
                <p-table *ngIf="ctr.tipoDescartes.length > 0" [value]="ctr.tipoDescartes"
                         [tableStyle]="{ 'min-width': '50rem' }">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Nome</th>
                            <th>Valor</th>
                            <th class="col-2">Ação</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-tipoDescarte>
                        <tr>
                            <td>{{ tipoDescarte.nome }}</td>
                            <td>{{ tipoDescarte.valor | currency: 'BRL' }}</td>
                            <td class="col-2">
                                <p-button id="remover" icon="pi pi-trash" label="Remover" styleClass="mb-2 p-button-sm"
                                          (onClick)="removerItemDescarte(tipoDescarte)"></p-button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="footer">
                        <p-divider></p-divider>
                        <span style="padding-right: 0">Valor Descarte Total: {{valorTotal | currency: 'BRL'}}</span>
                    </ng-template>
                </p-table>
            </div>
        </div>
        <p-divider align="left">
            <div class="inline-flex align-items-center">
                <i class="pi pi-user mr-2"></i>
                <b>Pagamento</b>
            </div>
        </p-divider>
        <div class="flex-auto">
            <div class="p-fluid p-formgrid grid">
                <div class="field col-6">
                    <label for="forma-pagamento">Forma de Pagamento</label>
                    <app-auto-complete
                        id="forma-pagamento"
                        [service]="formaPagamentoService"
                        (dataSelected)="onFormaPagamentoSelecionado($event)">
                    </app-auto-complete>
                </div>
                <div class="field col-6">
                    <label for="instituicao-bancaria">Instituição Bancária</label>
                    <app-auto-complete
                        id="instituicao-bancaria"
                        [service]="instituicaoBancariaService"
                        (dataSelected)="onInstituicaoBancariaSelecionado($event)">
                    </app-auto-complete>
                </div>
            </div>
            <div class="p-fluid p-formgrid grid">
                <div class="field col-6">
                    <label for="valor">Valor</label>
                    <p-inputNumber id="valor" mode="decimal"
                                   [(ngModel)]="pagamento.valor">
                    </p-inputNumber>
                </div>
                <div class="field col-6">
                    <label for="dataPagamento">Data de Pagamento</label>
                    <p-calendar id="dataPagamento" [(ngModel)]="pagamento.dataPagamento" dateFormat="dd/mm/yy"
                                [maxDate]="pagamento.dataPagamento"
                                [showIcon]="true" inputId="icon">
                    </p-calendar>
                </div>
            </div>
            <div class="flex-auto">
                <div class="p-fluid p-formgrid grid">
                    <div class="col-9">
                    </div>
                    <div class="col-3">
<!--                        <button  pButton pRipple type="button" label="Secondary" class="p-button-raised p-button-secondary"></button>-->
                        <button pButton pRipple type="button"  id="adicionarPagamento" icon="pi pi-money-bill" label="Adicionar Pagamento"
                                  [disabled]="pagamento.instituicaoBancaria.id === '' || pagamento.valor == 0 || pagamento.formaPagamento.id === ''"
                                class="p-button-raised p-button-help" (click)="adicionarPagamento()"></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="field">
            <p-table *ngIf="ctr.pagamentos.length > 0" [value]="ctr.pagamentos"
                     [tableStyle]="{ 'min-width': '50rem' }">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Item</th>
                        <th>Forma Pagamento</th>
                        <th>Instituição Bancária</th>
                        <th>Valor</th>
                        <th>Data do Pagamento</th>
                        <th class="col-2">Ação</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-pgtItem>
                    <tr>
                        <td>{{pgtItem.item}}</td>
                        <td>{{ pgtItem.formaPagamento.nome }}</td>
                        <td>{{ pgtItem.instituicaoBancaria.nome}}</td>
                        <td>{{ pgtItem.valor | currency: 'BRL'}}</td>
                        <td>{{ pgtItem.dataPagamento | date: 'dd/MM/yyyy'}}</td>
                        <td class="col-2">
                            <p-button id="removerPagamento" icon="pi pi-trash" label="Remover"
                                      styleClass="mb-2 p-button-sm"
                                      (onClick)="removerPagamento(pgtItem)"></p-button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                    <p-divider></p-divider>
                    <span
                        style="padding-right: 0">Valor Pagamentos Total: {{pagamentosTotais | currency: 'BRL'}}</span>
                </ng-template>
            </p-table>
        </div>
    </div>
    <p-divider></p-divider>
    <div class="flex-auto">
        <div class="p-fluid p-formgrid grid">
            <div class="col-2">
                <button pButton pRipple type="button" id="limpar" icon="pi pi-eraser" label="Limpar" class="p-button-raised p-button-warning"
                          (click)="limpar()"></button>
<!--                <button pButton pRipple type="button" label="Warning" class="p-button-raised p-button-warning"></button>-->
            </div>
            <div class="col-8">
            </div>
            <div class="col-2">
                <button pButton pRipple type="button" id="lancar" icon="pi pi-save" label="Salvar"
                        class="p-button-raised p-button-success"
                           (click)="submit()"></button>
            </div>
        </div>
    </div>
</div>
